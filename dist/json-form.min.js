/**
 * JsonForm | A lightweight JavaScript library for generating forms from JSON/Object. v0.9.9 (https://github.com/Rmanaf/json-form)
 * Licensed under MIT (https://github.com/Rmanaf/json-form/blob/master/LICENSE)
 */
var __spreadArray=this&&this.__spreadArray||function(to,from,pack){if(pack||2===arguments.length)for(var i=0,l=from.length,ar;i<l;i++)!ar&&i in from||(ar||(ar=Array.prototype.slice.call(from,0,i)),ar[i]=from[i]);return to.concat(ar||Array.prototype.slice.call(from))},JsonFormLogLevel;!function(JsonFormLogLevel){JsonFormLogLevel[JsonFormLogLevel.Errors=0]="Errors",JsonFormLogLevel[JsonFormLogLevel.Events=1]="Events",JsonFormLogLevel[JsonFormLogLevel.All=2]="All",JsonFormLogLevel[JsonFormLogLevel.None=3]="None"}(JsonFormLogLevel||(JsonFormLogLevel={}));var JsonForm=function(){function JsonForm(data,options,target){var _this=this;void 0===options&&(options={}),void 0===target&&(target=null),this._nodes=[],this._sections=[];var defaults={body:document.body,model:"",exclude:[],labels:{},sections:{},types:{},attributes:{},templates:{},meta:{},events:{"*":"keyup keypress blur change","*-number":"keyup keypress blur change mouseup"}};if("string"==typeof data){var uid=this._uniqueID();window[uid]=JSON.parse(data),data=window[uid]}null!==target&&("string"==typeof target?this._target=document.getElementById(target):target instanceof HTMLElement?this._target=target:this._mayLog(JsonFormLogLevel.Errors)&&this._log("Error","Type of target is wrong!")),this._d=data,this._raw=data,this._o=this._extend(defaults,options),this.update(),setTimeout((function(){_this._dispatchEvent("init")}))}return JsonForm.prototype._uniqueID=function(){return"_"+Math.random().toString(36).substring(2,9)},JsonForm.prototype._getObjectName=function(o){for(var p in window)if(!(JsonForm.WIN_PROPS.indexOf(p)>-1)&&window[p]==o)return p;return"undefined"},JsonForm.prototype._extend=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];for(var i=1;i<args.length;i++)for(var key in args[i])args[i].hasOwnProperty(key)&&(args[0][key]=args[i][key]);return args[0]},JsonForm.merge=function(o1,o2){var r={};for(var a in o1)r[a]=o1[a];for(var a in o2)r[a]=o2[a];return r},JsonForm.prototype._updateTarget=function(){if(void 0!==this._target){var jsondata=this.updateTarget(JSON.stringify(this._d));this._target.value=jsondata,this._dispatchEvent("update.target",{target:this._target,data:jsondata})}},JsonForm.prototype.updateTarget=function(value){return value},JsonForm.prototype._bindEvents=function(e,en,l,options){for(var events="string"==typeof en?en.split(" "):en,i=0,iLen=events.length;i<iLen;i++)e.addEventListener(events[i],l,options)},JsonForm.prototype._createFromTemplate=function(id,path,v,t,type,l,template){var _a,_this=this,templateVal=this._o.templates[template],doc,temp,clone=this._o.body.ownerDocument.getElementById(templateVal).cloneNode(!0),dict={id:id,inputType:t,type:type,label:l,value:v,path:path},meta=this._pathIncludes(path,Object.keys(this._o.meta),t);meta&&(dict=JsonForm.merge(dict,this._o.meta[meta.match])),Object.keys(dict).forEach((function(key){var args=JsonForm.merge(dict,{parsePath:_this._parsePath});clone.innerHTML=clone.innerHTML.replace(/{{[^{}]+}}/g,function(key){var keySeq=key.replace(/[{}]+/g,"").split("|"),result=dict[keySeq[0]]||"";if("function"==typeof result){var userData=keySeq.length?keySeq.slice(1,keySeq.length):[];result=result(JsonForm.merge(args,{userData:userData}))}return result}.bind(_this))}));var fragment=document.importNode(clone.content,!0);(_a=this._nodes).push.apply(_a,fragment.childNodes),this._appendInput(fragment,path)},JsonForm.prototype._createInput=function(n,v,t,path,type){var _this=this,id=this._uniqueID(),input,label;this._o.labels.hasOwnProperty("*")&&(label=this._o.labels["*"]),this._o.labels.hasOwnProperty(path)&&(label=this._o.labels[path]),"function"==typeof label?n=label(n,path):void 0!==label&&(n=label);var template=this._pathIncludes(path,Object.keys(this._o.templates),t);if(template){if(this._createFromTemplate(id,path,v,t,type,n,template.match),void 0===(input=document.getElementById(id)))return void(this._mayLog(JsonFormLogLevel.Errors)&&this._log("Error","Missing element in <".concat(template.match,">")))}else(input=document.createElement("input")).setAttribute("id",id);input.setAttribute("name",id),input instanceof HTMLInputElement?input.setAttribute("type",t):input.dataset.jfInputType=t,input.dataset.jfPath=path,input.dataset.jfType=type,input.value=v,"checkbox"===t&&"boolean"===type&&(input.checked=v);var attribute=this._pathIncludes(path,Object.keys(this._o.attributes),t);if(attribute&&Object.keys(this._o.attributes[attribute.match]).forEach((function(attr){input.setAttribute(attr,_this._o.attributes[attribute.match][attr])})),!template){var label_1=document.createElement("label");if(label_1.setAttribute("for",id),"checkbox"===t){var span=document.createElement("span");span.innerHTML=n,label_1.appendChild(input),label_1.appendChild(span)}else label_1.innerHTML=n,label_1.appendChild(input);this._nodes.push(this._appendInput(label_1,path))}var events=this._o.events,event=this._pathIncludes(path,Object.keys(this._o.events),t);event&&(events=this._o.events[event.match]),this._bindEvents(input,events,this._eventHandler.bind(this))},JsonForm.prototype._appendInput=function(element,path,type){var _this=this;void 0===type&&(type="input");var parent=path.split(".").slice(0,-1).join("."),skey=Object.keys(this._o.sections).filter((function(s){var res;return!1!==_this._pathIncludes(path,_this._o.sections[s].children,type)})),isInArray=!1!==this._testArray(parent);if(skey.length){var theKey=skey[0],section=this._o.sections[theKey];if(this._sections.hasOwnProperty(parent)&&isInArray&&(theKey=parent),this._sections.hasOwnProperty(theKey))section=this._sections[theKey];else{var newSection=this._createElementFromHTML(section.template||"section");!0!==section.repeat?(newSection.setAttribute("data-section",theKey),this._sections[theKey]=newSection):!0===section.merge&&isInArray&&(newSection.setAttribute("data-section",parent),this._sections[parent]=newSection),this._o.body.appendChild(newSection),section=newSection,this._nodes.push(newSection)}return section.appendChild(element),element}return this._o.body.appendChild(element),element},JsonForm.prototype._pathIncludes=function(path,paths,type,checkAncestors){if(void 0===type&&(type="input"),void 0===checkAncestors&&(checkAncestors=!0),0===paths.length)return!1;if(paths.indexOf(path)>=0)return{path:path,match:path,mode:"exact"};if(paths.some((function(x){return/\/\S+\//.test(x)})))for(var p in paths){var regex;if(/\/\S+\//.test(paths[p]))if(JsonForm.stringToRegex(paths[p]).test(path))return{path:path,match:paths[p],mode:"regex"}}if(paths.some((function(x){return x==="*-".concat(type)})))return{path:path,match:"*-".concat(type),mode:"type"};if(paths.some((function(x){return"*"===x||"*.*"===x})))return{path:path,match:"*",mode:"wildcard"};if(checkAncestors)for(var pathClone=path;pathClone.length;){var p=pathClone.split(".").slice(0,-1).join(".");if(paths.indexOf(p)>=0)return{path:path,match:p,mode:"ancestor"};pathClone=p}return!1},JsonForm.stringToRegex=function(s,m){return void 0===m&&(m=null),(m=s.match(/^([\/~@;%#'])(.*?)\1([gimsuy]*)$/))?new RegExp(m[2],m[3].split("").filter((function(i,p,s){return s.indexOf(i)===p})).join("")):new RegExp(s)},JsonForm.prototype._eventHandler=function(e){var t=e.target.getAttribute("type"),type=e.target.dataset.jfType,path=e.target.dataset.jfPath,value=e.target.value;"checkbox"===t&&(value=e.target.checked),"number"===type&&""===value&&(value=0);try{this._updateData(path,value,type)}catch(error){return void(this._mayLog(JsonFormLogLevel.Errors)&&this._log("Error",'Unable to set value "'.concat(value,'" for "').concat(path,'".\n').concat(error.message)))}this._updateTarget(),this._dispatchEvent("change",{path:path,value:value,type:type,target:e.target})},JsonForm.prototype._parsePath=function(p){var _this=this,arr=p.split("."),obj={};"window"===arr[0]&&arr.shift();var param=arr.pop(),ta=this._testArray(param);return ta&&(arr.push(ta.value),param=ta.matches[1]),{object:obj=arr.reduce((function(a,b){var ta=_this._testArray(b);return ta?a[ta.value][ta.matches[1]]:a[b]}),window),parameter:param,get:function(){return void 0===param?obj:obj[param]},set:function(value){void 0!==param&&(obj[param]=value)}}},JsonForm.prototype._testArray=function(text){var arrayRegex=/\[([^)]+)\]/;return!!arrayRegex.test(text)&&{matches:arrayRegex.exec(text),value:text.replace(arrayRegex,"")}},JsonForm.prototype._updateData=function(p,v,t){var args={path:p,value:this._castToType(t,v),type:t},data=this._parsePath(p);data.object[data.parameter]=this.updateData(args).value,this._dispatchEvent("update.data",args)},JsonForm.prototype.updateData=function(args){return args},JsonForm.prototype._castToType=function(type,input){switch(type){case"number":return Number(input);case"boolean":return Boolean(input);default:return input}},JsonForm.prototype._checkValues=function(d,path){var _this=this,pathInfo,child=this._parsePath(path).get(),type=typeof child,inputType="text";switch(type){case"object":return void(Array.isArray(child)?child.forEach((function(v,i,a){var newPath="".concat(path,"[").concat(i,"]");_this._checkValues(v,newPath)})):Object.keys(child).forEach((function(e){var newPath="".concat(path,".").concat(e);_this._checkValues(e,newPath)})));case"boolean":inputType="checkbox";break;case"number":inputType="number"}var types=this._pathIncludes(path,Object.keys(this._o.types),inputType),exclude;types&&(inputType=this._o.types[types.match]),this._pathIncludes(path,this._o.exclude,inputType)||this._createInput(d,child,inputType,path,type)},JsonForm.prototype._clearForm=function(dispatch){void 0===dispatch&&(dispatch=!1),this._nodes.forEach((function(node){null!==node.parentNode&&node.parentNode.removeChild(node)})),this._nodes=[],this._sections=[],dispatch&&this._dispatchEvent("clear")},JsonForm.prototype._mayLog=function(level){return JsonForm.LOG_LEVEL!==JsonFormLogLevel.None&&(JsonForm.LOG_LEVEL===level||JsonForm.LOG_LEVEL==JsonFormLogLevel.All)},JsonForm.prototype._log=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var now=(new Date).toISOString().slice(11,-1);console.log.apply(console,__spreadArray([now],args,!1))},JsonForm.prototype._dispatchEvent=function(type,detail){void 0===detail&&(detail=null);var evt="".concat(JsonForm.EVENT_NS,".").concat(type);this._o.body.dispatchEvent(detail?new CustomEvent(evt,{detail:detail}):new Event(evt)),this._mayLog(JsonFormLogLevel.Events)&&this._log("Event",evt,JSON.stringify(detail)||"")},JsonForm.prototype.destroy=function(){this.resetAll(),this._clearForm(),this._dispatchEvent("distroy")},JsonForm.prototype.data=function(){return this._d},JsonForm.prototype.set=function(o,v){if(this._o.hasOwnProperty(o)){var type=typeof this._o[o],valType=typeof v;typeof v==typeof this._o[o]?this._o[o]=v:this._mayLog(JsonFormLogLevel.Errors)&&this._log("Error",'Type mismatch for "'.concat(o,'" : "').concat(type,'". Current value is "').concat(valType,'".'))}else this._mayLog(JsonFormLogLevel.Errors)&&this._log("Error",'"'.concat(o,'" is not defined.'))},JsonForm.prototype.clear=function(){this._clearForm(!0)},JsonForm.prototype.update=function(){var model=this.model(),objName=this._getObjectName(this._d),path=this.hasModel()?"".concat(objName,".").concat(model):objName;this._clearForm(),this._checkValues(model,path),this._updateTarget(),this._dispatchEvent("update")},JsonForm.prototype.model=function(){return this._o.model},JsonForm.prototype.hasModel=function(){return!!this.model().length},JsonForm.prototype.value=function(){var model=this.model(),data=this.data();return model.length?data[model]:data},JsonForm.prototype.raw=function(){return this._raw},JsonForm.prototype.reset=function(model){void 0===model&&(model="");var initData=this._raw,_m=this.model();return model.length&&(_m=model),_m.length?this._o.data[model]=initData[model]:this._o.data=initData,this.data()},JsonForm.prototype.resetAll=function(){return this.reset("")},JsonForm.prototype._createElementFromHTML=function(htmlString){if(/<\/?[a-z][\s\S]*>/i.test(htmlString)){var tmp=document.implementation.createHTMLDocument();return tmp.body.innerHTML=htmlString,tmp.body.firstChild}return document.createElement(htmlString)},JsonForm.prototype.addEventListener=function(type,listener,options){this._bindEvents(this._o.body,type,listener,options)},JsonForm.EVENT_NS="json-form",JsonForm.WIN_PROPS=Object.getOwnPropertyNames(window),JsonForm.LOG_LEVEL=JsonFormLogLevel.None,JsonForm}();